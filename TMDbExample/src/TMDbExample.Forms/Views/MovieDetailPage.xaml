<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ff="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
             xmlns:converters="clr-namespace:TMDbExample.Forms.Converters"
             x:Class="TMDbExample.Forms.Views.MovieDetailPage"
             Title="{Binding Title}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:StringJoinValueConverter x:Key="genresToString" Separator=", " />
            <converters:DateTimeIsFutureValueConverter x:Key="isFutureConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout>
            <Grid RowSpacing="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="110"></RowDefinition>
                    <RowDefinition Height="65"></RowDefinition>
                    <RowDefinition Height="75"></RowDefinition>
                    <RowDefinition Height="6"></RowDefinition>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="100"></ColumnDefinition>
                    <ColumnDefinition Width="1*"></ColumnDefinition>
                </Grid.ColumnDefinitions>

                <ff:CachedImage
                    Aspect="AspectFill"
                    Source="{Binding Movie.BackdropUrl, TargetNullValue='no_image_poster.png'}"
                    LoadingPlaceholder="no_image_poster.png"
                    ErrorPlaceholder="no_image_poster.png"
                    Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="3" Grid.RowSpan="2" Opacity="0.6" />

                <BoxView BackgroundColor="#50ff5a00" Grid.Row="2" Grid.ColumnSpan="3" HorizontalOptions="Fill" VerticalOptions="Fill" Margin="0" />

                <Frame Grid.Column="1" Grid.Row="1" Grid.RowSpan="3" BackgroundColor="#66000000" Padding="3" HasShadow="False">
                    <ContentView HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                        <ff:CachedImage Aspect="AspectFill"
                            Source="{Binding Movie.PosterUrl, TargetNullValue='no_image_poster.png'}"
                            LoadingPlaceholder="no_image_poster.png"
                            ErrorPlaceholder="no_image_poster.png"
                            VerticalOptions="Fill" HorizontalOptions="Fill" />
                    </ContentView>
                </Frame>

                <Label Text="{Binding Movie.Title}" TextColor="#080808" FontSize="Medium"
                    VerticalOptions="CenterAndExpand" HorizontalOptions="CenterAndExpand"
                    MaxLines="3" LineBreakMode="TailTruncation"
                    Grid.Column="2" Grid.Row="2" />
            </Grid>
            <StackLayout Margin="10">
                <Label Text="{Binding Movie.Genres, Converter={StaticResource genresToString}, ConverterParameter='No genre info available', StringFormat='{0}'}" FontSize="Micro" />
                <Label Text="{Binding Movie.Overview }" />
                <BoxView HorizontalOptions="FillAndExpand" HeightRequest="1" BackgroundColor="Gray" />
                <Label Text="{Binding Movie.ReleaseDate, TargetNullValue='No release date info', StringFormat='Coming out in {0:MMM d, yyyy}'}" HorizontalOptions="EndAndExpand">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label" Binding="{Binding Movie.ReleaseDate, Converter={StaticResource isFutureConverter}}" Value="False">
                            <Setter Property="Text" Value="{Binding Movie.ReleaseDate, TargetNullValue='No release date info', StringFormat='Released in {0:MMM d, yyyy}'}" />
                        </DataTrigger>
                    </Label.Triggers>
                </Label>
            </StackLayout>
        </StackLayout>
    </ScrollView>

</ContentPage>